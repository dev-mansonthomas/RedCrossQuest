<acme-navbar></acme-navbar>
<div class="container"  data-ng-controller="DepartTroncController as dt">

  <div class="panel panel-primary"  style="background-color: #5cb85c!important;border-color:#5cb85c!important;">
    <div class="panel-heading" style="background-color: #5cb85c!important;border-color:#5cb85c!important;"><h2>Départ Tronc</h2></div>
  </div>


  <div>
    <div class="well">
      <form novalidate  name="departTroncForm">
        <div class="row">
          <div class="col-md-4" style="text-align:center;">

            <qr-scanner
              ng-success="dt.qrCodeScanOnSuccess(data)"
                ng-error="dt.qrCodeScanOnError(error)"
          ng-video-error="dt.qrCodeScanOnVideoError(error)"
                   width="320"
                  height="200"></qr-scanner>

            <span class="help-block" ng-bind="dt.decodedData"></span>
          </div>

          <div class=" col-md-4">
            <div class="form-group" ng-class="{'has-error':departTroncForm.troncId.$invalid}">
              <label for="troncId" class="control-label">Id Tronc</label>
              <input
                id="troncId"
                type="text"
                ng-model="dt.current.tronc"
                placeholder="Scanner le QRCode du tronc"
                uib-typeahead="tronc as tronc.stringView for tronc in dt.searchTronc($viewValue)"
                typeahead-loading="loadingTroncs"
                typeahead-no-results="noTroncsResults"
                typeahead-wait-ms="20"
                class="form-control"
                ng-required
                autocomplete="off">
              <i   ng-show="loadingTroncs" class="glyphicon glyphicon-refresh"></i>
              <div ng-show="noTroncResults">
                <i class="glyphicon glyphicon-remove"></i> Aucun Tronc trouvé
              </div>

              <span class="help-block">Scan QR Code, avec mode secours saisie manuelle</span>
            </div>
            <div class="form-group">
              <label for="lieuDeQuete" class="control-label">Lieu de Quête</label>
              <select name="lieuDeQuete" id="lieuDeQuete" class="form-control" ng-model="dt.current.tronc_queteur.point_quete.id" disabled
                      ng-options="pq.id as pq.code+' - '+pq.name
                      for
                      pq in dt.current.pointsQuete">
              </select>
            </div>
          </div>
          <div class=" col-md-4">

            <div class="form-group" ng-class="{'has-error':departTroncForm.horaireDepartTheorique.$invalid}">
              <label for="horaireDepartTheorique" class="control-label">Horaire Théorique de Départ</label>
              <input name="horaireDepartTheorique"
                     id="horaireDepartTheorique"
                     type="datetime-local"
                     class="form-control"
                     ng-model="dt.current.tronc_queteur.depart_theorique"
                     readonly/>
              <span class="help-block">C'est l'horaire qui avait été planifié</span>
              <span class="help-block" ng-show="departTroncForm.horaireDepartTheorique.$error.required">Required</span>
            </div>

            <div class="form-group" ng-class="{'has-error':departTroncForm.depart.$invalid}">
              <label for="depart" class="control-label">Horaire Départ Réel</label>
              <input name="depart"
                     id="depart"
                     type="datetime-local"
                     class="form-control"
                     ng-model="dt.current.tronc_queteur.depart"
                     readonly/>
              <span class="help-block" ng-show="departTroncForm.depart.$error.required">Required</span>
            </div>
          </div>
        </div>

        <div class="row" ng-show="dt.current.tronc_queteur && dt.savedSuccessfully">
          <div class="col-md-8 col-md-offset-2">
            <div class="alert alert-success alert-dismissible" role="alert" style="text-align: center;">
              <button type="button" class="close" data-dismiss="alert" aria-label="Close" ng-click="dt.savedSuccessfully=false"><span aria-hidden="true">&times;</span></button>
              <span class="glyphicon glyphicon-ok-circle" aria-hidden="true" style="font-size:40px;color:green;"></span> <b>{{dt.current.tronc_queteur.queteur.first_name}} {{dt.current.tronc_queteur.queteur.last_name}}</b> est <span ng-show="dt.current.tronc_queteur.departAlreadyRegistered">déjà</span> enregistré comme parti à l'horaire indiqué ci-dessus.<br/>
              Vous pouvez scanner dès maintenant le prochain départ de tronc.
            </div>
          </div>
        </div>

      </form>
    </div>
  </div>
</div>

